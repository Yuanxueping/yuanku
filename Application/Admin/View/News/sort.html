<include file='Public:header' /> 
 <include file='Public:menu' /> 
<link rel="stylesheet" href="__PUBLIC__/css/admin/new_sort.css">
<div class="panel panel-primary">
	<div class="panel-heading">
		<span>新闻分类</span>
		<a href="{:U('News/sort_add')}" class="btn btn-success btn-sm white pull-right">添加分类</a>
	</div>
	<table class="table table-hover">
      	<thead>
        	<tr>
	          	<th>#</th>
	          	<th>ID</th>
		        <th>分类</th>
		        <th class="text-center">操作</th>
        	</tr>
      	</thead>
      	<tbody id="ajax_rt_box">
      		<volist name="news_list" id="vo" key="k">
      			<tr>
      				<td>{$k}</td>
					<td class="changeid">{$vo['id']}</td>
					<td class="changename">{$vo['sort_name']}</td>
					<td class="text-center">
						<div class="btn-group">
							<button type="button" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-pencil"></span></button>
							<button onclick="location.href='{:U('News/sort_del',array('id'=>$vo[id]))}'" type="button" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-trash"></span></button>
						</div>
					</td>
				</tr>
			</volist>
      	</tbody>
    </table>
</div>
<div class="btn-toolbar text-center" role="toolbar">
	<div class="btn-group">
		{$page_html}
	</div>
</div>

<script type="text/javascript">
$(function(){
	$("#ajax_rt_box").find(".btn-xs").click(function(){
		var this_box=$(this).parent().parent().prev();
		var id=this_box.prev().html();
		console.log(id);
		var oldval=this_box.html();
        this_box.html('<input type="text" autofocus="true">').addClass('cur_input');
       $(".cur_input").find('input').focus();
		$(".cur_input").find('input').blur(function(){
			 var changeval=$(".cur_input").find('input').val();
			 
			 if(changeval!=oldval&&changeval!=""){
			 	$.post('{:U("News/ajax_set_sort")}',{"id":id,"changeval": changeval},function(msg){
			 		 if(msg.stauts==1){
			 		 	this_box.html(changeval);
			 		 }
			 		 else if(msg.stauts==-1){
			 		 	alert("修改失败");
			 		 }
			 	
			 })
			}else{
				alert("没有修改！");
				this_box.html(oldval);
				
			}
			 
			 
		})
	})
})
// var cur_step=1;
// var old_val;
// var ajax_num=1;
// $(function  () {
//        $('.pwd_box').click(function  () {
//             if (cur_step==1) {
//               $('.cur_input').html($('.cur_input').attr('pwd')); 
//               // 不对当前td删除
//               $('.cur_input').removeClass('cur_input');
//
//                $(this).addClass('cur_input');
//                $(this).html('<input type="text">');
//                old_val=$(this).attr('pwd');
//                ajax_num=1;
//             }
//              
//
//              var this_box=$(this);
//
//              var input_val=$(this).find('input').val();
//              //已经有输入新值的输入框，再点击我们不赋老的值
//              if (input_val!="" && input_val!=old_val) {
//                 old_val=input_val;
//              } 
//              $(this).find('input').focus().val(old_val).blur(function  () {
//                  
//
//                    var change_val=this_box.find('input').val();
//                     
//
//                    // 判断是不是有修改
//                    if(old_val!=change_val && ajax_num==1){
//
//                      //提交到ajax_url，相关参数都通过jquery.post
//                      $.post(ajax_url,{"id":this_box.attr('id_val'),"change_val":change_val},function  (rtn) {
//                        // 在回调函数里，提示用户返回过来的提示信息
//                          if(rtn.stauts==1){
//                            this_box.html(change_val);
//                            this_box.attr('pwd',change_val);
//
//                            cur_step=1;
//                            $('.cur_input').html($('.cur_input').attr('pwd')); 
//                            $('.cur_input').removeClass('cur_input');
//                          }else if(rtn.stauts==-1){
//                            cur_step=2;
//                            alert(rtn.msg);
//                          }else{
//                            cur_step=2;
//                            $(this).focus();
//                            alert(rtn.msg);
//                          }
//
//                      });
//                    }else{
//                      cur_step=1;
//                      ajax_num=2;
//                      $('.cur_input').html($('.cur_input').attr('pwd')); 
//                      $('.cur_input').removeClass('cur_input');
//
//                    }
//
//
//              });
//            
//        })
//        
//    })
</script>
 <include file='Public:footer' /> 
